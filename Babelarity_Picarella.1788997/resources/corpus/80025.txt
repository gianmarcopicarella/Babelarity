Chroma key compositing, or chroma keying, is a special effects / post-production technique for compositing (layering) two images or video streams together based on color hues (chroma range). The technique has been used heavily in many fields to remove a background from the subject of a photo or video – particularly the newscasting, motion picture and videogame industries. A color range in the foreground footage is made transparent, allowing separately filmed background footage or a static image to be inserted into the scene. The chroma keying technique is commonly used in video production and post-production. This technique is also referred to as color keying, colour-separation overlay (CSO; primarily by the BBC), or by various terms for specific color-related variants such as green screen, and blue screen – chroma keying can be done with backgrounds of any color that are uniform and distinct, but green and blue backgrounds are more commonly used because they differ most distinctly in hue from most human skin colors. No part of the subject being filmed or photographed may duplicate the color used as the backing.
It is commonly used for weather forecast broadcasts, wherein a news presenter is usually seen standing in front of a large CGI map during live television newscasts, though in actuality it is a large blue or green background. When using a blue screen, different weather maps are added on the parts of the image where the color is blue. If the news presenter wears blue clothes, his or her clothes will also be replaced with the background video. Chroma keying is also common in the entertainment industry for special effects in movies and videogames.
Prior to the introduction of travelling mattes and optical printing, double exposure was used to introduce elements into a scene which weren't present in the initial exposure. This was done using black draping where a green screen would be used today. George Albert Smith first used this approach in 1898. In 1903, The Great Train Robbery by Edwin S. Porter used double exposure to add background scenes to windows which were black when filmed on set, using a garbage matte to expose only the window areas.
In order to have figures in one exposure actually move in front of a substituted background in the other, a travelling matte was needed, to occlude the correct portion of the background in each frame. In 1918 [[Frank Williams]] patented a travelling matte technique, again based on using a black background. This was used in many films, such as The Invisible Man.
In the 1920s, Walt Disney used a white backdrop to include human actors with cartoon characters and backgrounds in his Alice Comedies.
The blue screen method was developed in the 1930s at RKO Radio Pictures. At RKO, Linwood Dunn used an early version of the travelling matte to create "wipes" – where there were transitions like a windshield wiper in films such as Flying Down to Rio (1933). Credited to Larry Butler, a scene featuring a genie escaping from a bottle was the first use of a proper bluescreen process to create a traveling matte for The Thief of Bagdad (1940), which won the Academy Award for Best Special Effects that year. In 1950, Warner Brothers employee and ex-Kodak researcher Arthur Widmer began working on an ultraviolet travelling matte process. He also began developing bluescreen techniques: one of the first films to use them was the 1958 adaptation of the Ernest Hemingway novella, The Old Man and the Sea, starring Spencer Tracy.
Petro Vlahos was awarded an Academy Award for his refinement of these techniques in 1964. His technique exploits the fact that most objects in real-world scenes have a color whose blue-color component is similar in intensity to their green-color component. Zbigniew Rybczyński also contributed to bluescreen technology. An optical printer with two projectors, a film camera and a 'beam splitter', was used to combine the actor in front of a blue screen together with the background footage, one frame at a time. In the early 1970s, American and British television networks began using green backdrops instead of blue for their newscasts. During the 1980s, minicomputers were used to control the optical printer. For the film The Empire Strikes Back, Richard Edlund created a 'quad optical printer' that accelerated the process considerably and saved money. He received a special Academy Award for his innovation.
For decades, travelling matte shots had to be done "locked-down", so that neither the matted subject nor the background could shift their camera perspective at all. Later, computer-timed, motion-control cameras alleviated this problem, as both the foreground and background could be filmed with the same camera moves.
Meteorologists on television often use a field monitor, to the side of the screen, to see where they are putting their hands against the background images. A newer technique is to project a faint image onto the screen.
Some films make heavy use of chroma key to add backgrounds that are constructed entirely using computer-generated imagery (CGI). Performances from different takes can be composited together, which allows actors to be filmed separately and then placed together in the same scene. Chroma key allows performers to appear to be in any location without leaving the studio. The comedy show Tosh.0 in particular is known for filming entirely with green-screen and then cutting the image being produced by the computer to show Daniel Tosh standing directly on the purely green set. This is always done at the very end of the show.
Computer development also made it easier to incorporate motion into composited shots, even when using handheld cameras. Reference-points can be placed onto the colored background (usually as a painted grid, X's marked with tape, or equally spaced tennis balls attached to the wall). In post-production, a computer can use the references to compute the camera's position and thus render an image that matches the perspective and movement of the foreground perfectly. Modern advances in software and computational power have eliminated the need to accurately place the markers – the software figures out their position in space (a disadvantage of this is that it requires a large camera movement, possibly encouraging modern film techniques where the camera is always in motion).
The principal subject is filmed or photographed against a background consisting of a single color or a relatively narrow range of colors, usually blue or green because these colors are considered to be the furthest away from skin tone. The portions of the video which match the preselected color are replaced by the alternate background video. This process is commonly known as "keying", "keying out" or simply a "key".
Green is used as a backdrop more than any other color because image sensors in digital video cameras are most sensitive to green, due to the Bayer pattern allocating more pixels to the green channel, mimicking the human eye's increased sensitivity to green light. Therefore, the green camera channel contains the least "noise" and can produce the cleanest key, matte, or mask. Additionally, less light is needed to illuminate green, again because of the higher sensitivity to green in image sensors. Bright green has also become favored since a blue background may match a subject's eye color or common items of clothing such as jeans.
Before digital chroma keying, bluescreening was accomplished using film. The camera color negative was printed onto high-contrast black and white film, using either a filter or the color sensitivity of the black and white film to limit it to the blue channel. Assuming this film was a negative it produced clear where the bluescreen was, black elsewhere, except it also produced clear for any white objects (since they also contained blue). Removing these spots could be done by a suitable double-exposure with the color positive, and many other techniques. The end result was a clear background with an opaque shape of the subject in the middle. This is called a female matte, similar to an alpha matte in digital keying. Copying this film onto another high-contrast negative produced the opposite 'male matte'. The background negative was then packed with the female matte and exposed onto a final strip of film, then the camera negative was packed with the male matte was double-printed onto this same film. These two images combined together creates the final effect.
The most important factor for a key is the color separation of the foreground (the subject) and background (the screen) – a bluescreen will be used if the subject is predominately green (for example plants), despite the camera being more sensitive to green light.
In analog color TV, color is represented by the phase of the chroma subcarrier relative to a reference oscillator. Chroma key is achieved by comparing the phase of the video to the phase corresponding to the preselected color. In-phase portions of the video are replaced by the alternate background video.
In digital color TV, color is represented by three numbers (red, green, blue intensity levels). Chroma key is achieved by a simple numerical comparison between the video and the preselected color. If the color at a particular point on the screen matches (either exactly, or in a range), then the video at that point is replaced by the alternate background
In order to create an illusion that characters and objects filmed are present in the intended background scene, the lighting in the two scenes must be a reasonable match. For outdoor scenes, overcast days create a diffuse, evenly colored light which can be easier to match in the studio, whereas direct sunlight needs to be matched in both direction and overall color based on time of day.
A studio shot taken in front of a green screen will naturally have ambient light the same color as the screen, due to its light scattering. This effect is known as spill. This can look unnatural or cause portions of the characters to disappear, so must be compensated for, or avoided by using a larger screen placed far from the actors.
The depth of field used to record the scene in front of the colored screen should match that of the background. This can mean recording the actors with a larger depth of field than normal.
A chroma key subject must avoid wearing clothes which are similar in color to the chroma key color(s) (unless intentional e.g. wearing a green top to make it appear that the subject has no body), because the clothing may be replaced with the background video. An example of intentional use of this is when an actor wears a blue covering over a part of his body to make it invisible in the final shot. This technique can be used to achieve an effect similar to that used in the Harry Potter films to create the effect of an invisibility cloak. The actor can also be filmed against a chroma-key background and inserted into the background shot with a distortion effect, in order to create a cloak that is marginally detectable.
Difficulties emerge with bluescreen when a costume in an effects shot must be blue, such as Superman's traditional blue outfit. In the 2002 film Spider-Man, in scenes where both Spider-Man and the Green Goblin are in the air, Spider-Man had to be shot in front of the greenscreen and the Green Goblin had to be shot in front of a bluescreen. The color difference is because Spider-Man wears a costume which is red and blue in color and the Green Goblin wears a costume which is entirely green in color. If both were shot in front of the same screen, parts of one character would be erased from the shot.
For a clean division of foreground from background, it is also important that clothing and hair in the foreground shoot have a fairly simple sihouette, as fine details such as frizzy hair may not resolve properly. Similarly, partially transparent elements of the costume cause problems.
Blue is generally used for both weather maps and special effects because it is complementary to human skin tone. The use of blue is also tied to the blue emulsion layer of film having the finest crystals and thus good detail and minimal grain (in comparison to the red and green layers of the emulsion.) In digital filmmaking, however, green has become the favored color because digital cameras retain more detail in the green channel, and it requires less light than blue. Green not only has a higher luminance value than blue, but also in early digital formats, the green channel was sampled twice as often as the blue, making it easier to work with. The choice of color is up to the effects artists and the needs of the specific shot. In the past decade, the use of green has become dominant in film special effects. Also, the green background is favored over blue for outdoor filming where the blue sky might appear in the frame and could accidentally be replaced in the process. Although green and blue are the most common, any color can be used. Red is usually avoided due to its prevalence in normal human skin pigments, but can be often used for objects and scenes which do not involve people.
So-called "yellow screen" is accomplished with a white backdrop. Ordinary stage lighting is used in combination with a bright yellow sodium lamp. The sodium light falls almost entirely in a narrow frequency band, which can then be separated from the other light using a prism, and projected onto a separate but synchronized film carrier within the camera. This second film is high-contrast black and white, and is processed to produce the matte.
Occasionally, a magenta background is used, as in some software applications where the magenta or fuchsia is sometimes referred to as "magic pink".
A newer technique is to use a retroreflective curtain in the background, along with a ring of bright LEDs around the camera lens. This requires no light to shine on the background other than the LEDs, which use an extremely small amount of power and space unlike big stage lights, and require no rigging. This advance was made possible by the invention in the 1990s of practical blue LEDs, which also allow for emerald green LEDs.
There is also a form of color keying that uses light spectrum invisible to human eye. Called Thermo-Key, it uses infrared as the key color, which would not be replaced by background image during postprocessing.
For Star Trek: The Next Generation, an ultraviolet light matting process was proposed by Don Lee of CIS and developed by Gary Hutzel and the staff of Image G. This involved a fluorescent orange backdrop which made it easier to generate a holdout matte, thus allowing the effects team to produce effects in a quarter of the time needed for other methods.
In principle, any type of still background can be used as a chroma key instead of a solid color. First the background is captured without actors or other foreground elements; then the scene is recorded. The image of the background is used to cancel the background in the actual footage; for example in a digital image, each pixel will have a different chroma key. This is sometimes referred to as a difference matte. However, this makes it easy for objects to be accidentally removed if they happen to be similar to the background, or for the background to remain due to camera noise or if it happens to change slightly from the reference footage. A background with a repeating pattern alleviates many of these issues, and can be less sensitive to wardrobe color than solid-color backdrops.
The biggest challenge when setting up a bluescreen or greenscreen is even lighting and the avoidance of shadow, because it is best to have as narrow a color range as possible being replaced. A shadow would present itself as a darker color to the camera and might not register for replacement. This can sometimes be seen in low-budget or live broadcasts where the errors cannot be manually repaired. The material being used affects the quality and ease of having it evenly lit. Materials which are shiny will be far less successful than those that are not. A shiny surface will have areas that reflect the lights making them appear pale, while other areas may be darkened. A matte surface will diffuse the reflected light and have a more even color range. In order to get the cleanest key from shooting greenscreen it is necessary to create a value difference between the subject and the greenscreen. In order to differentiate the subject from the screen, a two-stop difference can be used, either by making the greenscreen two stops higher than the subject, or vice versa.
Sometimes a shadow can be used to create a special effect. Areas of the bluescreen or greenscreen with a shadow on them can be replaced with a darker version of the desired background video image, making it look like the person is casting a shadow on them. Any spill of the chroma key color will make the result look unnatural. A difference in the focal length of the lenses used can affect the success of chroma key.
Another challenge for bluescreen or greenscreen is proper camera exposure. Underexposing or overexposing a colored backdrop can lead to poor saturation levels. In the case of video cameras, underexposed images can contain high amounts of noise, as well. The background must be bright enough to allow the camera to create a bright and saturated image.
There are several different quality- and speed-optimized techniques for implementing color keying in software.
In most versions, a function f(r, g, b) → α is applied to every pixel in the image. α (alpha) has a meaning similar to that in alpha compositing techniques. α = 0 means the pixel is fully in the green screen, α = 1 means the pixel is fully in the foreground object, and intermediate values smooth away any halo at the border of object and screen. A further function g(r, g, b) → (r, g, b) is needed to remove green spill on the foreground objects.
A very simple function is to subtract the green from the sum of the red and blue and clamp the result to the 0–1 range. Adding a user-adjustable multiplier to each color will allow it to be adjusted. Green spill is achieved by clamping g to not be larger than b. This is fairly close to the capabilities of analog and film-based screen pulling.
Most modern examples are best described by two closed nested surfaces in the 3-D rgb space, often quite complex. Colors inside the inner surface are considered green screen. Colors outside the outer surface are opaque foreground. Colors between the surfaces are partially covered, they are more opaque the closer they are to the outer surface. Sometimes more closed surfaces are used to determine how to remove green spill.
Professional keyers use far more sophisticated functions. It is also very common for f() to depend on more than just the current pixel's color, it may also use the (x, y) position, the values of nearby pixels, the value from reference images, and values from user-drawn masks. These produce closed surfaces in a space with more than three dimensions.
A different class of algorithm tries to figure out a 2D path that separates the foreground from the background. This path can be the output, or the image can be drawn by filling the path with α = 1 as a final step. An example of such an algorithm is the use of active contour. Most research in recent years has been into these algorithms.
